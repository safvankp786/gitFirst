!function(a){"use strict";function b(a){switch(a){case"listings":return f}}function c(b,c){"listings"===c&&(a(Estatik.settings.hfm_toggle_sidebar_selector).toggleClass("es-hidden","half_map"===b),a(document).trigger("listings_toggle_sidebar",{layout:b,entity_type:c}))}var d={initSearch:function(){a(document).find("[data-search-form-selector]").each(function(){var c,d=a(a(this).data("search-form-selector")).not(".js-es-event-added"),f=a(this);d.length&&d.each(function(){a(this).addClass("js-es-search--ajax").addClass("js-es-event-added");var d=a(this).find("form");d.on("change","input:not([type=text]):not([type=number]):not([type=search]),select",function(){var b=a(this),c=new e(f.find(".js-es-entities").data("hash"));"checkbox"===b.attr("type")&&c.delete(b.attr("name")),d.submit()}),d.on("focusout","input[type=text], input[type=number]",function(){d.submit()}),d.on("submit",function(){var g=f.find(".js-es-entities__wrap_inner"),h=d.serializeArray(),i=g.closest(".js-es-entities-wrap").find(".js-es-entities"),j=new e(i.data("hash"));if(j.clearQueryArguments(),h.length){var k={};h.forEach(function(a){a.value?(-1!==a.name.indexOf("[]")&&(k[a.name]=k[a.name]?k[a.name]:0,a.name=a.name.replace("[]","["+k[a.name]+++"]")),j.setValue(a.name,a.value)):j.delete(a.name)}),j.delete("prop_id"),j.setValue("page_num",1),j.setValue("paged-"+j.getValue("loop_uid"),1),j.setHistoryQuery()}i.data("hash",j.getHash()),c&&c.abort(),g.find(".js-es-entities").addClass("es-entities--loading");var l=i.data("entity"),m=b(l);return c=a.post(Estatik.settings.ajaxurl,{action:"get_"+l,hash:j.getHash(),reload_map:1},function(a){a=a||{},"success"===a.status&&m.append(a,g)},"json"),!1})})})},append:function(c,d,e){if("success"===c.status){var f=d.offset().top-+Estatik.settings.listings_offset_corrector,g=d.replaceWith(c.message);return b(g.find(".js-es-entities").data("entity")).init(g.closest(".js-es-entities-wrap")),e="undefined"===e||e,e&&a([document.documentElement,document.body]).animate({scrollTop:f||0},500),d.find(".js-es-entities").removeClass("es-entities--loading"),a(window).trigger("resize"),g}}},e=function(a,b){b=b||!1;var c=this;return this.hash=a,this.attributes=new URLSearchParams(decodeURIComponent(escape(window.atob(this.hash)))),b||(this.tempEntitiesHash=new e(a,!0)),this.shortcode_attributes=["layout","posts_per_page","disable_navbar","show_sort","show_total","show_page_title","show_layouts","limit","page_num","loop_uid","page_title","fields","collapsed_fields","main_fields","ignore_search","search_form_selector","enable_search","search_type","view_all_link_name","wishlist_confirm","view_all_page_id","disable_pagination","_ajax_mode","_ignore_coordinates","reload_map","hfm_full_width","ajax_response_mode","fields_delimiter","action","hash","prop_id","enable_ajax","strict_address","map_show"],e.prototype.clearQueryArguments=function(){var a=this,b=this.tempEntitiesHash,c=Estatik.search.fields;this.tempEntitiesHash.getAttributes().forEach(function(d,e){b.shortcode_attributes.includes(e)||c.includes(e)||a.delete(e)})},e.prototype.getValue=function(a){return c.attributes.get(a)},e.prototype.getAllValues=function(a){return c.attributes.getAll(a)},e.prototype.setValue=function(a,b){return c.attributes.set(a,b),c.hash=btoa(c.attributes.toString()),c},e.prototype.delete=function(a){return c.attributes.delete(a),c.hash=btoa(c.attributes.toString()),c},e.prototype.getHash=function(){return c.hash},e.prototype.getAttributes=function(){return this.attributes},e.prototype.toString=function(){return this.getHash()},e.prototype.setHistoryQuery=function(){var a=this.getAttributes(),b=this.tempEntitiesHash;b.getAttributes().forEach(function(c,d){b.shortcode_attributes.forEach(function(b,c){d.includes(b)&&a.delete(d)})});var c=decodeURIComponent(window.location.pathname+"?"+a.toString());window.history.replaceState({},"",c)},this};window.EstatikEntitiesHash=e;var f={halfMapInstances:[],init:function(){setTimeout(function(){f.initCarousel()},10)},getLayoutEntityType:function(){return"listings"},append:function(a,b,c){if("success"===a.status&&(d.append(a,b,c),+a.reload_map&&a.loop_uid)){var e=f.halfMapInstances[a.loop_uid];e&&(a.coordinates?e.setMarkers(a.coordinates):e.deleteMarkers())}},getLayoutClass:function(a){for(var b=1;b<10;b++){if(a.hasClass("es-listings--grid-"+b))return"es-listings--grid-"+b;if(a.hasClass("es-listings--grid-"+b))return"es-listings--grid-"+b}return"es-listings--list"},initCarousel:function(b,c){c=c||a(document),a(".js-es-slick.slick-initialized",c).slick("unslick"),a(".js-es-slick",c).each(function(){var c=a(this).data("slick")||{},d=c.slidesToShow||1,e=c.vertical||!1,g=!1;if(void 0!==c.infinite&&(c.infinite=Boolean(c.infinite)),c.rtl=Estatik.settings.is_rtl,e)a(this).hasClass("slick-initialized")||(g=a(this));else if(!a(this).hasClass("slick-initialized")){var h=a(this).width(),i=parseInt(h/230)||1;g=a(this),c.slidesToShow=d<=i?d:i}g&&(g.on("init",function(){g.removeClass("slick-hidden")}).slick(c),g.find(".js-es-slick").length&&g.on("beforeChange",function(c,d,e,h){a(d.$list).find(".js-es-slick:not(.slick-initialized)").length&&f.initCarousel(b,g)}))})}};window.EstatikProperties=f;var g=function(b){this.$wrapper=b,this.mapInstance=null,this.markers=[],this.clusters=[],this.load_first_time=!0,this.ignoreLoadListingsByBounds=!0;var c=this;g.prototype.init=function(){if(this.setFullWidth(),"undefined"==typeof google)return!1;this.$map=a(".js-es-map",c.$wrapper),this.map=c.$map[0],this.mapInstance=new google.maps.Map(c.map,{draggable:!0,zoom:16}),this.setMarkers(c.$map.data("listings")),this.mapInstance.addListener("click",function(){c.close_popups()}),a(window).on("resize",function(){c.setFullWidth()}),c.mapInstance.addListener("zoom_changed",function(){if(c.load_first_time||c.ignoreZoomHandler)return c.load_first_time=!1,!1;c.close_popups(),c.loadListingsFromVisibleBounds()}),c.mapInstance.addListener("dragend",function(){c.loadListingsFromVisibleBounds()})},g.prototype.setFullWidth=function(){if(this.$wrapper.hasClass("es-properties--hfm")&&this.$wrapper.hasClass("es-properties--hfm--full-width")){this.$wrapper.css("margin-left",0);var a=this.$wrapper[0].getBoundingClientRect(),b=a.left;this.$wrapper.css("margin-left",-b+"px")}},g.prototype.loadListingsFromVisibleBounds=function(){if(c.ignoreLoadListingsByBounds)return!1;if("undefined"==typeof google)return!1;var b=[],d=c.mapInstance.getBounds();if(c.markers.length){for(var g in c.markers)if(c.markers.hasOwnProperty(g)){var h=c.markers[g].getPosition();void 0!==d&&d.contains(h)&&b.push(c.markers[g].post_id)}b.length||b.push(-1);var i=new e(c.$wrapper.find(".js-es-listings").data("hash"));i.setValue("prop_id",b.join(",")),i.setValue("page_num",1),i.setValue("paged-"+i.getValue("loop_uid"),1),void 0!==c.xhr&&c.xhr.abort(),c.$wrapper.find(".js-es-listings").addClass("es-listings--loading"),c.xhr=a.post(Estatik.settings.ajaxurl,{reload_map:0,hash:i.getHash(),action:"get_listings"},function(a){f.append(a,c.$wrapper.find(".js-es-entities__wrap_inner"),!1)},"json")}},a(c.$wrapper).on("mouseenter",".js-es-listing",function(){var b=a(this).data("post-id");if(void 0!==c.markers[b]){var d=c.markers[b],e={};"price"!==Estatik.settings.map_marker_type&&(e=d.getIcon());var f=d.marker_svg;f&&(f=f.replaceAll("data-color",'style="fill: '+Estatik.settings.main_color+'"'),e.url="data:image/svg+xml;charset=UTF-8;base64,"+window.btoa(f),d.setIcon(e))}}),a(c.$wrapper).on("mouseleave",".js-es-listing",function(){var b=a(this).data("post-id");if(void 0!==c.markers[b]){var d=c.markers[b],e={};"price"!==Estatik.settings.map_marker_type&&(e=d.getIcon());var f=d.marker_svg;f&&(f=f.replaceAll("data-color",'style="fill: '+d.marker_color+'"'),e.url="data:image/svg+xml;charset=UTF-8;base64,"+window.btoa(f),d.setIcon(e))}}),g.prototype.deleteMarkers=function(){if("undefined"==typeof google)return!1;if(c.clusters.length)for(var a in c.clusters)c.clusters.hasOwnProperty(a)&&c.clusters[a].clearMarkers();if(c.markers.length)for(var b in c.markers)c.markers.hasOwnProperty(b)&&c.markers[b].setMap(null);c.markers=null,c.markers=[]},g.prototype.setMarkers=function(b){if("undefined"==typeof google)return!1;c.ignoreLoadListingsByBounds=!0;var d,e=new google.maps.LatLngBounds,f=new OverlappingMarkerSpiderfier(c.mapInstance,{markersWontMove:!0,markersWontHide:!0,basicFormatEvents:!0,keepSpiderfied:!0});if(c.$map.data("listings",b),c.deleteMarkers(),b){for(var h in b)if(b.hasOwnProperty(h)){var i=new google.maps.LatLng(parseFloat(b[h].lat),parseFloat(b[h].lng));e.extend(i),d={position:i,map:c.mapInstance,optimized:!1,zIndex:99};var j=null,k=null;void 0!==b[h].marker?(j=Estatik.settings.map_marker_icons[b[h].marker],k=b[h].marker_color):(j=Estatik.settings.map_marker_icons[Estatik.settings.map_marker_icon],k=Estatik.settings.map_marker_color),d.marker_svg=j,d.marker_color=k;var l=a(j),m=l.attr("width"),n=+l.attr("height");j=j.replaceAll("data-color",'style="fill: '+k+'"'),d.icon={url:"data:image/svg+xml;charset=UTF-8;base64,"+window.btoa(j),scaledSize:new google.maps.Size(m,n),size:new google.maps.Size(m,n),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(m/2,n/2),optimized:!1},d=new google.maps.Marker(d),d.post_id=b[h].post_id,google.maps.event.addListener(d,"click",c.propertyPopup(i,b[h])),c.markers[b[h].post_id]=d,f.addMarker(d)}if(void 0!==Estatik.settings.default_lat_lng){var o=Estatik.settings.default_lat_lng;c.mapInstance.setCenter({lat:+o[0],lng:+o[1]}),Estatik.settings.map_zoom&&c.mapInstance.setZoom(+Estatik.settings.map_zoom)}else void 0!==e&&(c.mapInstance.fitBounds(e),c.mapInstance.panToBounds(e));if(c.markers&&Estatik.settings.is_cluster_enabled){var p=[{width:44,height:44,url:g.getClusterIcon(),textColor:"white",textSize:10,anchorText:[16],anchorIcon:[38,22]}];"cluster3"===Estatik.settings.map_cluster_icon&&(p[0].textColor=Estatik.settings.map_cluster_color),+Estatik.settings.is_cluster_enabled&&"price"!==Estatik.settings.map_marker_type&&c.clusters.push(new MarkerClusterer(c.mapInstance,c.markers,{maxZoom:12,styles:p}))}}c.ignoreLoadListingsByBounds=!1},g.prototype.propertyPopup=function(b,d){return function(){var b={post_id:d.post_id,action:"es_get_property_item"};void 0!==c.xhr&&c.xhr.abort(),c.close_popups(),c.xhr=a.post(Estatik.settings.ajaxurl,b,function(b){if(b=b||{},d.content=b.content,d.position=new google.maps.LatLng(d.lat,d.lng),"success"===b.status){var e=new EsGoogleMapPopup(d);c.mapInstance.setCenter(d.position),e.setMap(c.mapInstance),e.getMap().panToWithOffset(d.position,0,120),setTimeout(function(){f.initCarousel(a(c.mapInstance.getDiv()))},100)}},"json")}},g.prototype.close_popups=function(){var a=c.mapInstance.getDiv().querySelector(".es-map-popup");a&&a.remove()},g.getClusterIcon=function(a){a=a||Estatik.settings.map_cluster_color;var b=Estatik.settings.map_cluster_icons[Estatik.settings.map_cluster_icon];return b=b.replaceAll("data-color",'style="fill:'+a+'"').replaceAll("data-hide",'style="fill:#ffffff"'),"data:image/svg+xml;base64,"+window.btoa(b)}};window.EstatikHalfMap=g,a(function(){f.init(),d.initSearch(),a(".js-es-properties__map.es-properties__map--visible").each(function(){var b=a(this).closest(".js-es-properties"),d=new g(b),h=b.find(".js-es-listings"),i=new e(h.data("hash"));f.halfMapInstances[i.getValue("loop_uid")]=d,d&&(d.init(),c("half_map","listings"))}),a(document).on("click",".js-es-entities-filter-item",function(c){var d=a(this),f=d.data("query");if(f&&Object.keys(f).length){var g=d.closest(".js-es-entities-wrap").find(".js-es-entities"),h=d.closest(".js-es-entities-wrap").find(".js-es-entities__wrap_inner"),i=g.data("entity"),j=b(i),k=new e(g.data("hash"));Object.entries(f).forEach(function(a){k.setValue(a[0],a[1])}),k.setHistoryQuery();var l={action:"get_"+i,hash:k.getHash(),reload_map:1};a.post(Estatik.settings.ajaxurl,l,function(a){j.append(a,h)},"json")}return c.preventDefault(),!1}),a(document).on("click",".js-es-change-layout",function(){if(!a(this).hasClass("es-btn--active")){var d=a(this).data("layout"),h=a(this).closest(".js-es-control--layouts"),i=a(this).closest(".js-es-entities-wrap"),j=i.find(".js-es-entities"),k=j.data("entity"),l=b(k),m=l.getLayoutClass(j);i.removeClass("es-properties--hfm");var n=new e(j.data("hash"));n.setValue("layout",d),n.setHistoryQuery(),h.find(".js-es-change-layout").removeClass("es-btn--active"),a(this).addClass("es-btn--active");var o=d;if("half_map"===d){i.find(".js-es-properties__map").addClass("es-properties__map--visible"),i.addClass("es-properties--hfm");var p=new g(i);f.halfMapInstances[n.getValue("loop_uid")]=p,p&&p.init(),d=Estatik.settings.grid_layout}else{var q=i.find(".js-es-properties__map");q.length&&(q.removeClass("es-properties__map--visible"),i.css({"margin-left":"-15px"}))}Estatik.settings.hfm_toggle_sidebar&&Estatik.settings.hfm_toggle_sidebar_selector&&c(o,k);var r=l.getLayoutEntityType();j.removeClass(m).addClass("es-"+r+"--"+d).data("layout","es-"+r+"--"+d),j.data("hash",n.getHash()),l.init(),a(window).trigger("resize")}return!1}),a(document).on("click",".js-es-pagination a.page-numbers",function(){var c=a(this).closest(".es-pagination");if(!c.find(".page-numbers--preload").length){var d=c.closest(".es-properties--hfm").length,f=a(this).data("page-number"),g=a(this).closest(".js-es-entities__wrap_inner"),h=g.find(".js-es-entities");h.addClass("es-entities--loading");var i=new e(h.data("hash")),j=h.data("entity"),k=b(j),l={reload_map:d,action:"get_"+j,hash:i.setValue("page_num",f).getHash()},m=i.getValue("loop_uid"),n=g.find(".js-es-sort").val();i.setValue("paged-"+m,f),i.setValue("sort-"+m,n),i.setValue("sort",n),i.setHistoryQuery(),a(this).addClass("page-numbers--preload"),c.addClass("es-pagination--disabled"),a.post(Estatik.settings.ajaxurl,l,function(a){k.append(a,g,!0)},"json")}return!1}),a(document).on("change",".js-es-sort",function(){var c=a(this),d=c.closest(".js-es-entities__wrap_inner");if(d.length){c.prop("disabled","disabled");var f=d.find(".js-es-entities");f.addClass("es-entities--loading");var g=new e(f.data("hash")),h=g.getValue("loop_uid");g.setValue("sort-"+h,c.val()),g.setValue("sort",c.val()),g.setValue("page_num",1),g.setValue("paged-"+h,1),g.setHistoryQuery();var i=f.data("entity"),j=b(i),k={action:"get_"+i,hash:g.getHash(),reload_map:1};a.post(Estatik.settings.ajaxurl,k,function(a){j.append(a,d)},"json").always(function(){c.removeProp("disabled").removeAttr("disabled")})}}),a(document).on("click",".js-es-remove-filters",function(){a(this).addClass("es-btn--preload").attr("disabled","disabled").prop("disabled","disabled");var b=a(this).closest(".js-es-entities-wrap");return b.find(".js-es-address").val(""),b.find(".js-es-search-nav__item").find("input,select").each(function(){var b=a(this),c=a(this).prop("type");if("radio"===c||"checkbox"===c){b.removeProp("checked").removeAttr("checked");var d=a(this).closest(".js-search-field-container").find('input[value=""]');d.length&&d.prop("checked","checked")}else a(this).val("")}),b.find(".js-es-search form").trigger("submit"),!1})})}(jQuery);