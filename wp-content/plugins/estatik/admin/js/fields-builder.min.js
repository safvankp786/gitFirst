!function(a){"use strict";function b(){var b=a(document).find(".js-es-fields-builder-fields-list, .js-es-sections-list");b.sortable({cancel:".disable-order",change:function(b,c){var d=a(b.target);d.hasClass("js-es-sections-list")&&c.placeholder.index()<1&&d.find(".disable-order").after(c.placeholder)},update:function(b,c){var d,e=a(b.target),f={items:[],action:"es_fields_builder_change_items_order",field_builder_nonce:Estatik_Fields_Builder.nonce.update_items_order};e.find("li").each(function(){var b=a(this);d=b.data("machine-name"),f.items.push(d)}),e.hasClass("js-es-sections-list")?f.type="sections":f.type="fields",g&&g.abort(),g=a.post(ajaxurl,f,function(a){a=a||{},a.message&&Estatik_Admin.renderNotification(a.message)},"json").fail(function(){}).always(function(){})}}),b.disableSelection()}function c(c){var d=a("#"+c),e={field_builder_nonce:Estatik_Fields_Builder.nonce.get_fields_tab,machine_name:c,action:"es_fields_builder_get_fields_tab"};d.html("").addClass("es-preload"),a.get(ajaxurl,e,function(a){"success"===a.status&&a.content&&(d.html(a.content),b())},"json").fail(function(){}).always(function(){d.removeClass("es-preload")})}function d(c){var d=a(".js-es-sections-list"),e=a(".es-tabs__fields-builder .es-tabs__nav"),f={field_builder_nonce:Estatik_Fields_Builder.nonce.get_sections,action:"es_fields_builder_get_sections"};d.html(""),a.get(ajaxurl,f,function(a){"success"===a.status&&a.content&&(d.replaceWith(a.content),b(),c&&e.find('.es-tabs__nav-link[href="#'+c+'"]').trigger("click"))},"json").fail(function(){}).always(function(){})}function e(b,c){var d={field_builder_nonce:Estatik_Fields_Builder.nonce.get_section_form,action:"es_fields_builder_get_section_form",machine_name:b};c.html("").addClass("es-preload"),a.get(ajaxurl,d,function(a){c.html(a),c.find("input").trigger("change")}).fail(function(){}).always(function(){c.removeClass("es-preload")})}function f(b,c,d){var e={field_builder_nonce:Estatik_Fields_Builder.nonce.get_field_form,action:"es_fields_builder_get_field_form",machine_name:b,section_machine_name:c};d.html("").addClass("es-preload"),a.get(ajaxurl,e,function(a){d.html(a),d.find("input").trigger("change")}).fail(function(){}).always(function(){d.removeClass("es-preload")})}var g;a(function(){var g=a(".js-es-field-builder__form");a(document).on("change input","#es-fields-builder-form input, #es-fields-builder-form select, #es-fields-builder-form textarea",function(){var b=a(this).closest("form"),c=b.data("serialized");c&&c!==b.serialize()?b.find("[type=submit]").removeProp("disabled").removeAttr("disabled"):b.data("serialized",b.serialize())});var h=Estatik_Fields_Builder.tr;a(document).on("change",".js-es-field__input-type",function(){var b=a(this),c=a(this).closest("form").find("#es-field-machine_name").val(),d={machine_name:c,type:b.val(),action:"es_fields_builder_get_field_settings",field_builder_nonce:Estatik_Fields_Builder.nonce.get_field_settings};a(".js-es-fields-builder__field-settings").html(""),a.get(ajaxurl,d,function(b){b=b||{},b.message&&Estatik_Admin.renderNotification(b.message),b.content&&a(".js-es-fields-builder__field-settings").html(b.content).find("input").trigger("change")},"json").fail(function(){})}),a(document).on("submit","#es-fields-builder-form",function(){var h=a(this),i=h.find("[type=submit]");return i.prop("disabled","disabled").addClass("es-preload"),a.post(ajaxurl,h.serialize(),function(h){if(h=h||{},"success"===h.status){if(h.field){var i=h.field.section_machine_name;c(i),f(!1,h.field.section_machine_name,g),a('.es-tabs__nav .es-tabs__nav-link[href="#'+i+'"]').trigger("click")}h.section&&(a("#"+h.section.machine_name).length||a(".js-es-field-builder__form").before("<div class='js-es-tabs__content es-tabs__content' id='"+h.section.machine_name+"'></div>"),d(h.section.machine_name),c(h.section.machine_name),e(!1,g)),b(),a("html,body").animate({scrollTop:0},"slow")}h.message&&Estatik_Admin.renderNotification(h.message)},"json").fail(function(){}).always(function(){i.removeProp("disabled").removeAttr("disabled").removeClass("es-preload")}),!1}),a(document).on("click",".js-es-fields-list__item:not(.disable-edit)",function(){var b=a(this);return b.closest(".js-es-fields-list").find(".es-fields-list__item").removeClass("es-fields-list__item--active"),b.addClass("es-fields-list__item--active"),f(b.data("machine-name"),b.data("section-machine-name"),g),!1}),a(document).on("click",".js-es-section-item",function(){var b=a(this);return b.closest("li").find(".es-tabs__nav-link").trigger("click"),e(b.data("machine-name"),g),!1}),a(document).on("click",".es-fields-list__item-drag",function(a){return a.stopPropagation(),!1}),a(document).on("click",".js-es-fields-builder-section-delete-confirm",function(b){var c=a(this),d=c.data("machine-name"),e=c.data("section-label"),f=h.delete_section.replace("%s",e);return a.estatikPopup({inline_html:"<p class='es-center es-popup-text'>"+f+"</p><div class='es-popup__buttons es-center'><button class='js-es-popup__close es-btn es-btn es-btn--link'>"+h.cancel+"</button><button data-machine-name='"+d+"' class='js-es-fields-builder-remove-section es-btn es-btn--secondary'>"+h.remove+"</button></div>"}).open(),b.stopPropagation(),!1}),a(document).on("click",".js-es-fields-builder-remove-section",function(){a(this).addClass("preload");var b=a(this).data("machine-name"),f={machine_name:b,action:"es_fields_builder_delete_section",field_builder_nonce:Estatik_Fields_Builder.nonce.delete_section};a.post(ajaxurl,f,function(f){f=f||{},"success"===f.status&&(d(),c(b),e(!1,g),a("html,body").animate({scrollTop:0},"slow")),f.message&&Estatik_Admin.renderNotification(f.message)},"json").fail(function(){}).always(function(){a.estatikPopup().close()})}),a(document).on("click",".js-es-fields-list__item-delete",function(b){var c=a(this),d=c.data("machine-name"),e=c.data("field-label"),f=c.data("section-machine-name"),g=h.delete_field.replace("%s",e);return a.estatikPopup({inline_html:"<p class='es-center es-popup-text'>"+g+"</p><div class='es-popup__buttons es-center'><button class='js-es-popup__close es-btn es-btn--link'>"+h.cancel+"</button><button data-id='"+c.data("id")+"' data-section-machine-name='"+f+"' data-machine-name='"+d+"' class='js-es-fields-builder-remove-field es-btn es-btn--secondary'>"+h.remove+"</button></div>"}).open(),b.stopPropagation(),!1}),a(document).on("click",".js-es-section-item-restore",function(){var b=a(this),c={action:"es_fields_builder_restore_section",field_builder_nonce:Estatik_Fields_Builder.nonce.restore_section,machine_name:b.data("machine-name")};return a.post(ajaxurl,c,function(b){"success"===b.status&&(d(),a("html,body").animate({scrollTop:0},"slow")),b.message&&Estatik_Admin.renderNotification(b.message)},"json"),!1}),a(document).on("click",".js-es-fields-list__item-add",function(){var b=a(this),d={action:"es_fields_builder_restore_field",field_builder_nonce:Estatik_Fields_Builder.nonce.restore_field,machine_name:b.data("machine-name")};return a.post(ajaxurl,d,function(d){"success"===d.status&&(c(b.data("section-machine-name")),a("html,body").animate({scrollTop:0},"slow")),d.message&&Estatik_Admin.renderNotification(d.message)},"json"),!1}),a(document).on("click",".js-es-fields-builder-remove-field",function(){a(this).addClass("preload");var b=a(this).data("machine-name"),d=a(this).data("id"),e=a(this).data("section-machine-name"),h={machine_name:b,id:d,action:"es_fields_builder_delete_field",field_builder_nonce:Estatik_Fields_Builder.nonce.delete_field};a.post(ajaxurl,h,function(b){b=b||{},"success"===b.status&&(f(!1,"basic-facts",g),c(e),a("html,body").animate({scrollTop:0},"slow")),b.message&&Estatik_Admin.renderNotification(b.message)},"json").fail(function(){}).always(function(){a.estatikPopup().close()})}),a(document).on("click",".js-es-fields-builder-add-field",function(){f(!1,a(this).data("section-machine-name"),g)}),new ClipboardJS(".js-es-fields-list__copy"),a(document).on("click",".js-es-fields-list__copy",function(a){return a.stopPropagation(),a.preventDefault(),!1}),a(document).on("click",".js-es-fields-builder-add-section",function(){e(!1,g)}),f(!1,"basic-facts",g),b()})}(jQuery);