!function(a){"use strict";function b(){for(var b,c=0;c<100;c++)if(b=a('.js-es-location[data-initialize="'+c+'"]'),b.length){b.val()||esLoadFieldLocations(b);break}}function c(){var b=[];b.push(a("#es-field-city").find("option:selected").html()),b.push(a("#es-field-state").find("option:selected").html()),b.push(a("#es-field-country").find("option:selected").html()),b.push(a("#es-field-address").val());var c=a(".js-es-form-map").get(0);if(b=b.filter(function(a){return!(void 0===a||!a.length)})){(new google.maps.Geocoder).geocode({address:b.join(" ")},function(b,e){if("OK"===e){var f=b[0].geometry.location.lng(),g=b[0].geometry.location.lat();d(f,g,c),a(".js-es-latitude").val(g),a(".js-es-longitude").val(f)}})}}function d(b,c,d){if("undefined"!=typeof google&&void 0!==google.maps){var g=!1;d.classList.remove("es-hidden");var h=new google.maps.Map(d,{center:{lat:+c,lng:+b},draggable:!0,zoom:16}),i=document.createElement("div");i.innerHTML=EstatikMetabox.tr.set_pin,i.setAttribute("data-label",EstatikMetabox.tr.save_pin),i.style.margin="10px",i.classList.add("es-btn","es-btn--third","es-btn--small"),i.addEventListener("click",function(){var a=this.getAttribute("data-label");return this.setAttribute("data-label",this.innerHTML),this.innerHTML=a,g=!g,!1}),h.controls[google.maps.ControlPosition.TOP_RIGHT].push(i);var j=new google.maps.Geocoder;google.maps.event.trigger(h,"resize");var k=new google.maps.Marker({position:h.getCenter(),map:h});return window.google.maps.event.addListener(h,"drag",function(a){g&&k.setPosition(h.getCenter())}),window.google.maps.event.addListener(h,"idle",function(){if(f){if(g){var b=h.getCenter();k.setPosition(b),a(".js-es-address-components").val()?j.geocode({latLng:b},function(a,b){b===google.maps.GeocoderStatus.OK&&e(a[0])}):(a(".js-es-latitude").val(b.lat()),a(".js-es-longitude").val(b.lng()))}}else f=!0}),h}}function e(b){var c=b.address_components,d=b.geometry.location,e=a(".js-es-location");a(".js-es-latitude").val(d.lat()),a(".js-es-longitude").val(d.lng()),a(".js-es-autocomplete-address").val(b.formatted_address),a(".js-es-address-components").val(JSON.stringify(c)),void 0!==c&&(e.prop("disabled",!0),c.forEach(function(b){b.types.forEach(function(c){e.each(function(){var d=a(this).data("address-components"),e=a(this);void 0!==d&&d.includes(c)&&("input"===e.prop("tagName").toLowerCase()?e.val(b.long_name):e.html(new Option(b.long_name,b.long_name,!1,!0)))})})}))}var f=!1;a(function(){a(document).on("click",".js-es-return-false",function(){return!1});var g=a(".js-es-form-map").get(0),h=a(".js-es-autocomplete-address:not(.disable-autocomplete)");if(b(),a(".js-es-manual-address").click(function(b){a(".js-es-location-fields").toggleClass("es-hidden");var c=a(".js-es-manual-address-input"),d=+c.val()||0;c.val(+!d),b.preventDefault()}),a(".js-es-select2-locations").select2({tags:!0,width:"100%"}),a(document).on("change",".js-es-location",function(){var b,d=a(this),e=d.data("dependency-fields");d.is(":disabled")||(e&&e.forEach(function(c){b=a("#es-field-"+c),esLoadFieldLocations(b,d)}),c())}),a(".js-es-latitude, .js-es-latitude").change(function(){var b=a(".js-es-latitude").val(),c=a(".js-es-longitude").val();b&&c&&d(c,b,g,a(".js-es-address-components").val())}).trigger("change"),h.on("keyup",function(){a(this).val().length||(a(".js-es-location").removeProp("disabled").removeAttr("disabled").html(!1).val(""),b(),a(".js-es-address-components").val("").data("value",!1))}),"undefined"!=typeof google&&void 0!==google.maps&&h.length){var i=new google.maps.places.Autocomplete(h.get(0));google.maps.event.addListener(i,"place_changed",function(){var a=i.getPlace();if(void 0!==a&&void 0!==a.geometry){var b=a.geometry.location;g&&(f=!1,d(b.lng(),b.lat(),g),e(a))}})}})}(jQuery);